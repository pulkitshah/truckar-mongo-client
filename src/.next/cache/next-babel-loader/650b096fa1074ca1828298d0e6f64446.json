{"ast":null,"code":"import { API } from \"aws-amplify\";\nimport { organisationsByUser } from \"../graphql/queries\";\nimport { createOrganisation, updateOrganisation } from \"../graphql/mutations\";\nimport { Organisation } from \"../models\";\nimport { DataStore, Predicates } from \"@aws-amplify/datastore\";\nimport moment from \"moment\";\nimport { slice } from \"../slices/organisations\";\nconst now = new Date();\n\nclass OrganisationApi {\n  async getOrganisationsByUser(user, dispatch) {\n    try {\n      //////////////////////// GraphQL API ////////////////////////\n      // const response = await API.graphql({\n      //   query: organisationsByUser,\n      //   variables: { user: user.id.toString() },\n      // });\n      // const organisationesDB = response.data.organisationsByUser.items\n      //////////////////////// GraphQL API ////////////////////////\n      //////////////////////// DataStore API ////////////////////////\n      const organisationesDB = await DataStore.query(Organisation, c => c.user(\"eq\", user.id)); //////////////////////// DataStore API ////////////////////////\n      // console.log(organisationesDB);\n      // Dispatch - Reducer\n\n      dispatch(slice.actions.getOrganisations(organisationesDB));\n      return organisationesDB;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  async createOrganisation(newOrganisation) {\n    const createdAt = moment().toISOString();\n    let org = newOrganisation;\n    org.createdAt = createdAt; // const response2 = await API.graphql({\n    //   query: createOrganisation,\n    //   variables: { input: newOrganisation },\n    //   authMode: \"AMAZON_COGNITO_USER_POOLS\",\n    // });\n\n    const response = await DataStore.save(new Organisation(org));\n    console.log(response);\n    return response;\n  }\n\n  async editOrganisation(editedOrganisation, dispatch) {\n    console.log(editedOrganisation);\n    const response = await API.graphql({\n      query: updateOrganisation,\n      variables: {\n        input: editedOrganisation\n      },\n      authMode: \"AMAZON_COGNITO_USER_POOLS\"\n    });\n    dispatch(slice.actions.updateOrganisation(response));\n    return response;\n  }\n\n}\n\nexport const organisationApi = new OrganisationApi();","map":{"version":3,"sources":["/Users/pulkitshah/Desktop/truckarv2/renderer/api/organisation-api.js"],"names":["API","organisationsByUser","createOrganisation","updateOrganisation","Organisation","DataStore","Predicates","moment","slice","now","Date","OrganisationApi","getOrganisationsByUser","user","dispatch","organisationesDB","query","c","id","actions","getOrganisations","error","console","log","newOrganisation","createdAt","toISOString","org","response","save","editOrganisation","editedOrganisation","graphql","variables","input","authMode","organisationApi"],"mappings":"AAAA,SAASA,GAAT,QAAoB,aAApB;AACA,SAASC,mBAAT,QAAoC,oBAApC;AACA,SAASC,kBAAT,EAA6BC,kBAA7B,QAAuD,sBAAvD;AACA,SAASC,YAAT,QAA6B,WAA7B;AACA,SAASC,SAAT,EAAoBC,UAApB,QAAsC,wBAAtC;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,KAAT,QAAsB,yBAAtB;AAEA,MAAMC,GAAG,GAAG,IAAIC,IAAJ,EAAZ;;AAEA,MAAMC,eAAN,CAAsB;AACpB,QAAMC,sBAAN,CAA6BC,IAA7B,EAAmCC,QAAnC,EAA6C;AAC3C,QAAI;AACF;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA,YAAMC,gBAAgB,GAAG,MAAMV,SAAS,CAACW,KAAV,CAAgBZ,YAAhB,EAA+Ba,CAAD,IAC3DA,CAAC,CAACJ,IAAF,CAAO,IAAP,EAAaA,IAAI,CAACK,EAAlB,CAD6B,CAA/B,CAbE,CAiBF;AAEA;AAEA;;AAEAJ,MAAAA,QAAQ,CAACN,KAAK,CAACW,OAAN,CAAcC,gBAAd,CAA+BL,gBAA/B,CAAD,CAAR;AAEA,aAAOA,gBAAP;AACD,KA1BD,CA0BE,OAAOM,KAAP,EAAc;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD;AACF;;AAED,QAAMnB,kBAAN,CAAyBsB,eAAzB,EAA0C;AACxC,UAAMC,SAAS,GAAGlB,MAAM,GAAGmB,WAAT,EAAlB;AACA,QAAIC,GAAG,GAAGH,eAAV;AACAG,IAAAA,GAAG,CAACF,SAAJ,GAAgBA,SAAhB,CAHwC,CAKxC;AACA;AACA;AACA;AACA;;AAEA,UAAMG,QAAQ,GAAG,MAAMvB,SAAS,CAACwB,IAAV,CAAe,IAAIzB,YAAJ,CAAiBuB,GAAjB,CAAf,CAAvB;AAEAL,IAAAA,OAAO,CAACC,GAAR,CAAYK,QAAZ;AACA,WAAOA,QAAP;AACD;;AAED,QAAME,gBAAN,CAAuBC,kBAAvB,EAA2CjB,QAA3C,EAAqD;AACnDQ,IAAAA,OAAO,CAACC,GAAR,CAAYQ,kBAAZ;AAEA,UAAMH,QAAQ,GAAG,MAAM5B,GAAG,CAACgC,OAAJ,CAAY;AACjChB,MAAAA,KAAK,EAAEb,kBAD0B;AAEjC8B,MAAAA,SAAS,EAAE;AAAEC,QAAAA,KAAK,EAAEH;AAAT,OAFsB;AAGjCI,MAAAA,QAAQ,EAAE;AAHuB,KAAZ,CAAvB;AAMArB,IAAAA,QAAQ,CAACN,KAAK,CAACW,OAAN,CAAchB,kBAAd,CAAiCyB,QAAjC,CAAD,CAAR;AAEA,WAAOA,QAAP;AACD;;AA9DmB;;AAiEtB,OAAO,MAAMQ,eAAe,GAAG,IAAIzB,eAAJ,EAAxB","sourcesContent":["import { API } from \"aws-amplify\";\nimport { organisationsByUser } from \"../graphql/queries\";\nimport { createOrganisation, updateOrganisation } from \"../graphql/mutations\";\nimport { Organisation } from \"../models\";\nimport { DataStore, Predicates } from \"@aws-amplify/datastore\";\nimport moment from \"moment\";\nimport { slice } from \"../slices/organisations\";\n\nconst now = new Date();\n\nclass OrganisationApi {\n  async getOrganisationsByUser(user, dispatch) {\n    try {\n      //////////////////////// GraphQL API ////////////////////////\n\n      // const response = await API.graphql({\n      //   query: organisationsByUser,\n      //   variables: { user: user.id.toString() },\n      // });\n      // const organisationesDB = response.data.organisationsByUser.items\n\n      //////////////////////// GraphQL API ////////////////////////\n\n      //////////////////////// DataStore API ////////////////////////\n\n      const organisationesDB = await DataStore.query(Organisation, (c) =>\n        c.user(\"eq\", user.id)\n      );\n\n      //////////////////////// DataStore API ////////////////////////\n\n      // console.log(organisationesDB);\n\n      // Dispatch - Reducer\n\n      dispatch(slice.actions.getOrganisations(organisationesDB));\n\n      return organisationesDB;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  async createOrganisation(newOrganisation) {\n    const createdAt = moment().toISOString();\n    let org = newOrganisation;\n    org.createdAt = createdAt;\n\n    // const response2 = await API.graphql({\n    //   query: createOrganisation,\n    //   variables: { input: newOrganisation },\n    //   authMode: \"AMAZON_COGNITO_USER_POOLS\",\n    // });\n\n    const response = await DataStore.save(new Organisation(org));\n\n    console.log(response);\n    return response;\n  }\n\n  async editOrganisation(editedOrganisation, dispatch) {\n    console.log(editedOrganisation);\n\n    const response = await API.graphql({\n      query: updateOrganisation,\n      variables: { input: editedOrganisation },\n      authMode: \"AMAZON_COGNITO_USER_POOLS\",\n    });\n\n    dispatch(slice.actions.updateOrganisation(response));\n\n    return response;\n  }\n}\n\nexport const organisationApi = new OrganisationApi();\n"]},"metadata":{},"sourceType":"module"}