{"ast":null,"code":"import _regeneratorRuntime from \"/Users/pulkitshah/Desktop/truckarv2/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/pulkitshah/Desktop/truckarv2/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/pulkitshah/Desktop/truckarv2/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/pulkitshah/Desktop/truckarv2/renderer/pages/dashboard/organisations/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect, useRef, useState } from \"react\";\nimport NextLink from \"next/link\";\nimport Head from \"next/head\";\nimport { useTranslation } from \"react-i18next\";\nimport moment from \"moment\";\nimport { Box, Button, Divider, Grid, InputAdornment, Tab, Tabs, TextField, Typography } from \"@mui/material\";\nimport { styled } from \"@mui/material/styles\";\nimport { organisationApi } from \"../../../api/organisation-api\";\nimport { AuthGuard } from \"../../../components/authentication/auth-guard\";\nimport { OnBoardingGuard } from \"../../../components/authentication/onboarding-guard\";\nimport { DashboardLayout } from \"../../../components/dashboard/dashboard-layout\";\nimport { OrganisationDrawer } from \"../../../components/dashboard/organisation/organisation-drawer\";\nimport OrganisationGrid from \"../../../components/dashboard/organisation/organisation-grid\";\nimport { useMounted } from \"../../../hooks/use-mounted\";\nimport { useAuth } from \"../../../hooks/use-auth\";\nimport { Plus as PlusIcon } from \"../../../icons/plus\";\nimport { Search as SearchIcon } from \"../../../icons/search\";\nimport { gtm } from \"../../../lib/gtm\"; // DataStore Imports\n// import { DataStore, Predicates } from \"@aws-amplify/datastore\";\n// import { Organisation } from \"../../../models\";\n\nvar tabs = [{\n  label: \"All\",\n  value: \"all\"\n}, {\n  label: \"Canceled\",\n  value: \"canceled\"\n}, {\n  label: \"Completed\",\n  value: \"complete\"\n}, {\n  label: \"Pending\",\n  value: \"pending\"\n}, {\n  label: \"Rejected\",\n  value: \"rejected\"\n}];\nvar sortOptions = [{\n  label: \"Newest\",\n  value: \"desc\"\n}, {\n  label: \"Oldest\",\n  value: \"asc\"\n}];\n\nvar applyFilters = function applyFilters(organisations, filters) {\n  return organisations.filter(function (organisation) {\n    if (filters.query) {\n      // Checks only the organisation number, but can be extended to support other fields, such as customer\n      // name, email, etc.\n      var containsQuery = organisation.number.toLowerCase().includes(filters.query.toLowerCase());\n\n      if (!containsQuery) {\n        return false;\n      }\n    }\n\n    if (typeof filters.status !== \"undefined\") {\n      var statusMatched = organisation.status === filters.status;\n\n      if (!statusMatched) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n};\n\nvar applySort = function applySort(organisations, organisation) {\n  return organisations.sort(function (a, b) {\n    var comparator = a.createdAt > b.createdAt ? -1 : 1;\n    return organisation === \"desc\" ? comparator : -comparator;\n  });\n};\n\nvar OrganisationListInner = styled(\"div\", {\n  shouldForwardProp: function shouldForwardProp(prop) {\n    return prop !== \"open\";\n  }\n})(function (_ref) {\n  var _objectSpread2, _ref2;\n\n  var theme = _ref.theme,\n      open = _ref.open;\n  return _objectSpread((_objectSpread2 = {\n    flexGrow: 1,\n    overflow: \"hidden\",\n    paddingBottom: theme.spacing(8),\n    paddingTop: theme.spacing(8),\n    zIndex: 1\n  }, _defineProperty(_objectSpread2, theme.breakpoints.up(\"lg\"), {\n    marginRight: -500\n  }), _defineProperty(_objectSpread2, \"transition\", theme.transitions.create(\"margin\", {\n    easing: theme.transitions.easing.sharp,\n    duration: theme.transitions.duration.leavingScreen\n  })), _objectSpread2), open && (_ref2 = {}, _defineProperty(_ref2, theme.breakpoints.up(\"lg\"), {\n    marginRight: 0\n  }), _defineProperty(_ref2, \"transition\", theme.transitions.create(\"margin\", {\n    easing: theme.transitions.easing.easeOut,\n    duration: theme.transitions.duration.enteringScreen\n  })), _ref2));\n});\n\nvar OrganisationList = function OrganisationList() {\n  _s();\n\n  var isMounted = useMounted();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _useAuth = useAuth(),\n      user = _useAuth.user;\n\n  var rootRef = useRef(null);\n  var queryRef = useRef(null);\n\n  var _useState = useState(\"all\"),\n      currentTab = _useState[0],\n      setCurrentTab = _useState[1];\n\n  var _useState2 = useState(\"desc\"),\n      sort = _useState2[0],\n      setSort = _useState2[1];\n\n  var _useState3 = useState([]),\n      organisations = _useState3[0],\n      setOrganisations = _useState3[1];\n\n  var _useState4 = useState({\n    query: \"\",\n    status: undefined\n  }),\n      filters = _useState4[0],\n      setFilters = _useState4[1];\n\n  var _useState5 = useState({\n    isOpen: false,\n    organisationId: null\n  }),\n      drawer = _useState5[0],\n      setDrawer = _useState5[1];\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var organisationsDB;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return organisationApi.getOrganisationsByUser(user);\n\n          case 3:\n            organisationsDB = _context.sent;\n            setOrganisations(organisationsDB.data.organisationsByUser.items);\n            _context.next = 10;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 7]]);\n  })), []);\n\n  var handleTabsChange = function handleTabsChange(event, value) {\n    setCurrentTab(value);\n    setFilters(function (prevState) {\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        status: value === \"all\" ? undefined : value\n      });\n    });\n  };\n\n  var handleQueryChange = function handleQueryChange(event) {\n    event.preventDefault();\n    setFilters(function (prevState) {\n      var _queryRef$current;\n\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        query: (_queryRef$current = queryRef.current) === null || _queryRef$current === void 0 ? void 0 : _queryRef$current.value\n      });\n    });\n  };\n\n  var handleSortChange = function handleSortChange(event) {\n    var value = event.target.value;\n    setSort(value);\n  };\n\n  var handleCloseDrawer = function handleCloseDrawer() {\n    setDrawer({\n      isOpen: false,\n      organisationId: null\n    });\n  }; // Usually query is done on backend with indexing solutions\n\n\n  var filteredOrganisations = applyFilters(organisations, filters);\n  var sortedOrganisations = applySort(filteredOrganisations, sort);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Dashboard: Organisation List | Truckar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        px: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        justifyContent: \"space-between\",\n        spacing: 3,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h4\",\n            children: t(\"Organisations\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(NextLink, {\n            href: \"/dashboard/organisations/new\",\n            passHref: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              component: \"a\",\n              startIcon: /*#__PURE__*/_jsxDEV(PlusIcon, {\n                fontSize: \"small\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 28\n              }, _this),\n              variant: \"contained\",\n              children: \"Add\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(TextField, {\n      label: \"Sort By\",\n      name: \"organisation\",\n      onChange: handleSortChange,\n      select: true,\n      SelectProps: {\n        \"native\": true\n      },\n      sx: {\n        m: 1.5\n      },\n      value: sort,\n      children: sortOptions.map(function (option) {\n        return /*#__PURE__*/_jsxDEV(\"option\", {\n          value: option.value,\n          children: option.label\n        }, option.value, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(OrganisationGrid, {\n      organisations: organisations\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(OrganisationDrawer, {\n      containerRef: rootRef,\n      onClose: handleCloseDrawer,\n      open: drawer.isOpen,\n      organisation: organisations.find(function (organisation) {\n        return organisation.id === drawer.organisationId;\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(OrganisationList, \"4BA88H5DknXvoP+339ZlNQVYdC0=\", false, function () {\n  return [useMounted, useTranslation, useAuth];\n});\n\n_c = OrganisationList;\n\nOrganisationList.getLayout = function (page) {\n  return /*#__PURE__*/_jsxDEV(AuthGuard, {\n    children: /*#__PURE__*/_jsxDEV(OnBoardingGuard, {\n      children: /*#__PURE__*/_jsxDEV(DashboardLayout, {\n        children: page\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 7\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 5\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 243,\n    columnNumber: 3\n  }, _this);\n};\n\nexport default OrganisationList;\n\nvar _c;\n\n$RefreshReg$(_c, \"OrganisationList\");","map":{"version":3,"sources":["/Users/pulkitshah/Desktop/truckarv2/renderer/pages/dashboard/organisations/index.js"],"names":["useEffect","useRef","useState","NextLink","Head","useTranslation","moment","Box","Button","Divider","Grid","InputAdornment","Tab","Tabs","TextField","Typography","styled","organisationApi","AuthGuard","OnBoardingGuard","DashboardLayout","OrganisationDrawer","OrganisationGrid","useMounted","useAuth","Plus","PlusIcon","Search","SearchIcon","gtm","tabs","label","value","sortOptions","applyFilters","organisations","filters","filter","organisation","query","containsQuery","number","toLowerCase","includes","status","statusMatched","applySort","sort","a","b","comparator","createdAt","OrganisationListInner","shouldForwardProp","prop","theme","open","flexGrow","overflow","paddingBottom","spacing","paddingTop","zIndex","breakpoints","up","marginRight","transitions","create","easing","sharp","duration","leavingScreen","easeOut","enteringScreen","OrganisationList","isMounted","t","user","rootRef","queryRef","currentTab","setCurrentTab","setSort","setOrganisations","undefined","setFilters","isOpen","organisationId","drawer","setDrawer","getOrganisationsByUser","organisationsDB","data","organisationsByUser","items","console","log","handleTabsChange","event","prevState","handleQueryChange","preventDefault","current","handleSortChange","target","handleCloseDrawer","filteredOrganisations","sortedOrganisations","px","m","map","option","find","id","getLayout","page"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\nimport NextLink from \"next/link\";\nimport Head from \"next/head\";\nimport { useTranslation } from \"react-i18next\";\nimport moment from \"moment\";\nimport {\n  Box,\n  Button,\n  Divider,\n  Grid,\n  InputAdornment,\n  Tab,\n  Tabs,\n  TextField,\n  Typography,\n} from \"@mui/material\";\nimport { styled } from \"@mui/material/styles\";\nimport { organisationApi } from \"../../../api/organisation-api\";\nimport { AuthGuard } from \"../../../components/authentication/auth-guard\";\nimport { OnBoardingGuard } from \"../../../components/authentication/onboarding-guard\";\nimport { DashboardLayout } from \"../../../components/dashboard/dashboard-layout\";\nimport { OrganisationDrawer } from \"../../../components/dashboard/organisation/organisation-drawer\";\nimport OrganisationGrid from \"../../../components/dashboard/organisation/organisation-grid\";\nimport { useMounted } from \"../../../hooks/use-mounted\";\nimport { useAuth } from \"../../../hooks/use-auth\";\nimport { Plus as PlusIcon } from \"../../../icons/plus\";\nimport { Search as SearchIcon } from \"../../../icons/search\";\nimport { gtm } from \"../../../lib/gtm\";\n\n// DataStore Imports\n// import { DataStore, Predicates } from \"@aws-amplify/datastore\";\n// import { Organisation } from \"../../../models\";\n\nconst tabs = [\n  {\n    label: \"All\",\n    value: \"all\",\n  },\n  {\n    label: \"Canceled\",\n    value: \"canceled\",\n  },\n  {\n    label: \"Completed\",\n    value: \"complete\",\n  },\n  {\n    label: \"Pending\",\n    value: \"pending\",\n  },\n  {\n    label: \"Rejected\",\n    value: \"rejected\",\n  },\n];\n\nconst sortOptions = [\n  {\n    label: \"Newest\",\n    value: \"desc\",\n  },\n  {\n    label: \"Oldest\",\n    value: \"asc\",\n  },\n];\n\nconst applyFilters = (organisations, filters) =>\n  organisations.filter((organisation) => {\n    if (filters.query) {\n      // Checks only the organisation number, but can be extended to support other fields, such as customer\n      // name, email, etc.\n      const containsQuery = organisation.number\n        .toLowerCase()\n        .includes(filters.query.toLowerCase());\n\n      if (!containsQuery) {\n        return false;\n      }\n    }\n\n    if (typeof filters.status !== \"undefined\") {\n      const statusMatched = organisation.status === filters.status;\n\n      if (!statusMatched) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n\nconst applySort = (organisations, organisation) =>\n  organisations.sort((a, b) => {\n    const comparator = a.createdAt > b.createdAt ? -1 : 1;\n\n    return organisation === \"desc\" ? comparator : -comparator;\n  });\n\nconst OrganisationListInner = styled(\"div\", {\n  shouldForwardProp: (prop) => prop !== \"open\",\n})(({ theme, open }) => ({\n  flexGrow: 1,\n  overflow: \"hidden\",\n  paddingBottom: theme.spacing(8),\n  paddingTop: theme.spacing(8),\n  zIndex: 1,\n  [theme.breakpoints.up(\"lg\")]: {\n    marginRight: -500,\n  },\n  transition: theme.transitions.create(\"margin\", {\n    easing: theme.transitions.easing.sharp,\n    duration: theme.transitions.duration.leavingScreen,\n  }),\n  ...(open && {\n    [theme.breakpoints.up(\"lg\")]: {\n      marginRight: 0,\n    },\n    transition: theme.transitions.create(\"margin\", {\n      easing: theme.transitions.easing.easeOut,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n  }),\n}));\n\nconst OrganisationList = () => {\n  const isMounted = useMounted();\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const rootRef = useRef(null);\n  const queryRef = useRef(null);\n  const [currentTab, setCurrentTab] = useState(\"all\");\n  const [sort, setSort] = useState(\"desc\");\n  const [organisations, setOrganisations] = useState([]);\n\n  const [filters, setFilters] = useState({\n    query: \"\",\n    status: undefined,\n  });\n  const [drawer, setDrawer] = useState({\n    isOpen: false,\n    organisationId: null,\n  });\n\n  useEffect(async () => {\n    try {\n      const organisationsDB = await organisationApi.getOrganisationsByUser(\n        user\n      );\n      setOrganisations(organisationsDB.data.organisationsByUser.items);\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n\n  const handleTabsChange = (event, value) => {\n    setCurrentTab(value);\n    setFilters((prevState) => ({\n      ...prevState,\n      status: value === \"all\" ? undefined : value,\n    }));\n  };\n\n  const handleQueryChange = (event) => {\n    event.preventDefault();\n    setFilters((prevState) => ({\n      ...prevState,\n      query: queryRef.current?.value,\n    }));\n  };\n\n  const handleSortChange = (event) => {\n    const value = event.target.value;\n    setSort(value);\n  };\n\n  const handleCloseDrawer = () => {\n    setDrawer({\n      isOpen: false,\n      organisationId: null,\n    });\n  };\n\n  // Usually query is done on backend with indexing solutions\n  const filteredOrganisations = applyFilters(organisations, filters);\n  const sortedOrganisations = applySort(filteredOrganisations, sort);\n\n  return (\n    <>\n      <Head>\n        <title>Dashboard: Organisation List | Truckar</title>\n      </Head>\n\n      <Box sx={{ px: 3 }}>\n        <Grid container justifyContent=\"space-between\" spacing={3}>\n          <Grid item>\n            <Typography variant=\"h4\">{t(\"Organisations\")}</Typography>\n          </Grid>\n          <Grid item>\n            <NextLink href=\"/dashboard/organisations/new\" passHref>\n              <Button\n                component=\"a\"\n                startIcon={<PlusIcon fontSize=\"small\" />}\n                variant=\"contained\"\n              >\n                Add\n              </Button>\n            </NextLink>\n          </Grid>\n        </Grid>\n      </Box>\n\n      <TextField\n        label=\"Sort By\"\n        name=\"organisation\"\n        onChange={handleSortChange}\n        select\n        SelectProps={{ native: true }}\n        sx={{ m: 1.5 }}\n        value={sort}\n      >\n        {sortOptions.map((option) => (\n          <option key={option.value} value={option.value}>\n            {option.label}\n          </option>\n        ))}\n      </TextField>\n      <OrganisationGrid organisations={organisations} />\n\n      <OrganisationDrawer\n        containerRef={rootRef}\n        onClose={handleCloseDrawer}\n        open={drawer.isOpen}\n        organisation={organisations.find(\n          (organisation) => organisation.id === drawer.organisationId\n        )}\n      />\n    </>\n  );\n};\n\nOrganisationList.getLayout = (page) => (\n  <AuthGuard>\n    <OnBoardingGuard>\n      <DashboardLayout>{page}</DashboardLayout>\n    </OnBoardingGuard>\n  </AuthGuard>\n);\n\nexport default OrganisationList;\n"]},"metadata":{},"sourceType":"module"}